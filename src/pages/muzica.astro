---
import Layout from '../layouts/Layout.astro';
import MusicPlayer from '../components/MusicPlayer';
import { getCollection } from 'astro:content';

// 1. Preluăm colecția audio
const allAudioFiles = await getCollection('audio');

// 2. Sortăm fișierele
const sortedAudio = allAudioFiles.sort((a, b) => {
  const dateA = new Date(a.data.pubDate || 0).getTime();
  const dateB = new Date(b.data.pubDate || 0).getTime();
  return dateB - dateA;
});

// SEO
const title = "Compoziții | Aurelian Epuraș";
const description = "Ascultă compozițiile lui Aurelian Epuraș (Epuras). Fragmente de suflet transpuse în sunet pur, de la pian solo la compoziții simfonice.";
const image = "/uploads/images/Aurelian-Epuras.jpg";
const imageAlt = "Aurelian Epuraș | Aurelian Epuras | Pianist Compozitor";

// 3. Mapăm datele pentru player
const tracks = sortedAudio.map((audio, index) => ({
  id: index + 1,
  title: audio.data.title,
  audio_file: audio.data.audio_file,
  duration: audio.data.duration || '4:32',
}));

const albumCover = sortedAudio[0]?.data.cover || '/uploads/images/audio-cover-1.jpg';

// Generăm automat schema pentru Google (Versiunea extinsă @graph)
const musicSchema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "MusicAlbum",
      "@id": "https://aurelianepuras.github.io/muzica/#album",
      "name": "Album 13",
      "byArtist": { "@id": "https://aurelianepuras.github.io/#person" },
      "image": `https://aurelianepuras.github.io${albumCover}`,
      "datePublished": "2023",
      "numTracks": tracks.length,
      "track": tracks.map(track => ({
        "@type": "MusicRecording",
        "name": track.title,
        "duration": `PT${track.duration.replace(':', 'M')}S`
      }))
    },
    {
      "@type": "WebPage",
      "@id": "https://aurelianepuras.github.io/muzica/#webpage",
      "url": "https://aurelianepuras.github.io/muzica/",
      "name": title,
      "isPartOf": { "@id": "https://aurelianepuras.github.io/#website" },
      "about": { "@id": "https://aurelianepuras.github.io/#person" },
      "breadcrumb": { "@id": "https://aurelianepuras.github.io/muzica/#breadcrumb" }
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://aurelianepuras.github.io/muzica/#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "item": { "@id": "https://aurelianepuras.github.io/", "name": "Acasă" }
        },
        {
          "@type": "ListItem",
          "position": 2,
          "item": { "@id": "https://aurelianepuras.github.io/muzica/", "name": "Muzică" }
        }
      ]
    }
  ]
};
---

<Layout
  title={title}
  description={description}
  image={image}
  imageAlt={imageAlt}
>
  <script type="application/ld+json" slot="head" is:inline set:html={JSON.stringify(musicSchema)} />

  <section class="pt-20 pb-20 bg-ivory dark:bg-navy-deep">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12 max-w-6xl mx-auto">
        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl text-navy dark:text-ivory-light mb-6">Muzica mea</h1>
        <div class="w-16 h-0.5 bg-gold-warm dark:bg-gold-bright mx-auto mb-6"></div>
        
        <p class="text-left md:text-center text-lg text-navy/70 dark:text-ivory-light/70 leading-relaxed">
          Ascultă ceea ce cuvintele nu pot rosti: fragmente de suflet transpuse în sunet pur. 
          De la piese pentru pian solo la compoziții simfonice, fiecare notă este o invitație 
          la introspecție și la descoperirea unei lumi unde timpul pare să stea pe loc.
        </p>
      </div>

      <MusicPlayer
        client:load
        albumTitle="Album 13"
        artist="Lansat în 2023 la Teatrul Dramatic „Ion D. Sîrbu” Petroșani" 
        albumCover={albumCover}
        currentTrackTitle={tracks[0]?.title || 'Dimineață în Carpați'}
        tracks={tracks}
        albumDescription='„13” este un album de pian cu caracter autobiografic, construit din fragmente de viață, memorie și asumare. Fiecare piesă marchează o etapă, o ruptură sau o revelație, fără artificii, cu sinceritate directă. Este un disc despre ceea ce rămâne după ce zgomotul dispare.'
        productionNotes='Albumul a fost înregistrat la Râmnicu Vâlcea și produs cu România Folk. Cristi Iordan la ingineria de sunet și masterizare. Toate drepturile producătorului și ale autorilor sunt rezervate. Reproducerea, distribuirea sau prezentarea publică neautorizată este interzisă și protejată prin lege. ©2023'
      />
    </div>
  </section>
</Layout>
