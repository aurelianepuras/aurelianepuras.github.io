---
import Layout from '../layouts/Layout.astro';
import GalleryCard from '../components/GalleryCard.astro';
import { getCollection } from 'astro:content';

// Am adăugat .reverse() aici ca să inverseze ordinea
const gallery = (await getCollection('gallery')).reverse();

// AICI definești variabilele pentru seo //
const title = "Foto | Aurelian Epuraș";
const description = "Deschide ochii și lasă sunetul să prindă formă, fiecare imagine spune o poveste din spatele scenei, chiar și după ce muzica s-a oprit.";
const image = "/uploads/images/Aurelian-Epuras.jpg"; 
const imageAlt = "Aurelian Epuraș | Pianist Compozitor";
---

<Layout
  title={title}
  description={description}
  image={image}
  imageAlt={imageAlt}
>
  <section class="py-20 bg-ivory dark:bg-navy-deep">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12 max-w-3xl mx-auto">
        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl text-navy dark:text-ivory-light mb-6">Galerie foto</h1>
        <div class="w-16 h-0.5 bg-gold-warm dark:bg-gold-bright mx-auto mb-6"></div>
        <p class="text-lg text-navy/70 dark:text-ivory-light/70">
          Fiecare imagine spune o poveste din spatele scenei, chiar și după ce muzica s-a oprit
        </p>
      </div>

      <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {gallery.map((item) => (
          <div class="cursor-pointer">
            <GalleryCard
              title={item.data.title}
              image={item.data.image}
              description={item.data.description}
            />
          </div>
        ))}
      </div>
    </div>
  </section>

  <div id="lightbox" class="hidden fixed inset-0 z-[9999] bg-[#F7F5F0]/95 dark:bg-[#0B1215]/95 flex items-center justify-center p-4 select-none">
    <button id="lightbox-close" class="absolute top-6 right-6 text-navy dark:text-ivory-light hover:text-gold-warm z-[10001] p-2">
      <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>

    <button id="lightbox-prev" class="hidden md:flex absolute left-4 md:left-10 text-navy dark:text-ivory-light hover:text-gold-warm z-[10001] p-4 transition-transform hover:scale-110">
      <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
    </button>

    <div class="max-w-5xl w-full flex flex-col items-center">
      <img id="lightbox-image" src="" alt="" class="max-h-[80vh] w-auto rounded-lg shadow-2xl" />
      <p id="lightbox-description" class="mt-4 text-navy dark:text-ivory-light font-medium"></p>
    </div>

    <button id="lightbox-next" class="hidden md:flex absolute right-4 md:right-10 text-navy dark:text-ivory-light hover:text-gold-warm z-[10001] p-4 transition-transform hover:scale-110">
      <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
    </button>
  </div>

  <script>
    const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-image');
  const lightboxDesc = document.getElementById('lightbox-description');
  const closeBtn = document.getElementById('lightbox-close');
  const prevBtn = document.getElementById('lightbox-prev');
  const nextBtn = document.getElementById('lightbox-next');
    
  const imagesInGrid = Array.from(document.querySelectorAll('#gallery-grid img'));
    let currentIndex = 0;

    // Logica Swipe
    let touchStartX = 0;
    let touchEndX = 0;

    function openLightbox(index: number) {
      currentIndex = index;
      updateLightbox();
      lightbox?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function updateLightbox() {
      const img = imagesInGrid[currentIndex];
      if (lightboxImg && img) {
        lightboxImg.src = img.src;
        if (lightboxDesc) lightboxDesc.textContent = img.alt || "";
      }
    }

    function closeLightbox() {
      lightbox?.classList.add('hidden');
      document.body.style.overflow = '';
    }

    function showNext() {
      currentIndex = (currentIndex + 1) % imagesInGrid.length;
      updateLightbox();
    }

    function showPrev() {
      currentIndex = (currentIndex - 1 + imagesInGrid.length) % imagesInGrid.length;
      updateLightbox();
    }

    // Event-uri pentru Swipe
    lightbox?.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    lightbox?.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      if (touchStartX - touchEndX > 50) showNext();
      if (touchEndX - touchStartX > 50) showPrev();
    }, { passive: true });

    imagesInGrid.forEach((img, index) => {
      img.addEventListener('click', () => openLightbox(index));
    });

    closeBtn?.addEventListener('click', (e) => { e.stopPropagation(); closeLightbox(); });
    nextBtn?.addEventListener('click', (e) => { e.stopPropagation(); showNext(); });
    prevBtn?.addEventListener('click', (e) => { e.stopPropagation(); showPrev(); });
    
    // Închide la click pe fundal, dar nu pe imagine
    lightbox?.addEventListener('click', (e) => {
        if (e.target === lightbox) closeLightbox();
    });
    
    document.addEventListener('keydown', (e) => {
      if (lightbox?.classList.contains('hidden')) return;
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') showNext();
      if (e.key === 'ArrowLeft') showPrev();
    });
  </script>
</Layout>